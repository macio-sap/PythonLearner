#KPI040-人均产出工时

> Written with [StackEdit](https://stackedit.io/).

<span id="TableOfContent">Table Of Content</span>

[TOC]


##Mapping清单
[Top](#TableOfContent)

### EDW_DM层
[Top](#TableOfContent)

+ S_F_AVG_MAN_HOUR_0
	+ 实现功能
		+ 1、计算平均在册人数，从补录数据中整理出有效信息
		+ 2、统计完工车辆清单，完工数量统计
		+ 3、完工车辆调整结果输出
	+ 目标表
		+ BI_DM.TMP_PP_KPI040_DLVLST
		+ BI_DM.TMP_PP_KPI040_DLVLSTADJ
		+ BI_DM.TMP_PP_KPI040_DLVCNT
		+ BI_DM.TMP_PP_KPI040_EMPLOYEE_TOTAL
	+ 数据源表
		+ BI_DM.D_WORKSHOP
		+ BI_DM.TMP_PP_KPI040_DLVLST
		+ BI_DW.APD_PP_ACTOVER_LIST
		+ BI_DW.APD_PP_EMPLOYEE_TOTAL
		+ BI_DW.EVT_VEHICLE_ORDER_REAL
		+ BI_DW.EVT_YTVIN
		+ BI_DW.EVT_ZAFVV
		+ BI_DW.PRD_ZMAN_HOUR_SUM
		+ BI_DW.TMP_KPI040_021GT_CNFLST
		+ BI_DW.TMP_KPI040_IT_DATA
	+ 关联参数 
		+ `$$KPI040_DT_FROM`
+ S_F_AVG_MAN_HOUR_0ZERO
	+ 实现功能
		+ 进一步整理完工记录调整信息
	+ 目标表
		+ BI_DM.TMP_PP_KPI040_DLVLST
		+ BI_DM.TMP_PP_KPI040_DLVLSTADJ
	+ 数据源表
		+ BI_DM.TMP_PP_KPI040_DLVLST
	+ 关联参数 
+ S_F_AVG_MAN_HOUR_1
	+ 实现功能
		+ 计算订单工时、特改工时和返工工时
	+ 目标表
		+ BI_DM.TMP_PP_KPI040_WSVOR_HOUR
		+ BI_DM.TMP_PP_KPI040_ABNORMAL
	+ 数据源表
	+ BI_DM.D_WORKSHOP
		+ BI_DM.ETL_LOAD_PLAN
		+ BI_DW.APD_PP_ACTOVER_LIST
		+ BI_DW.C_T527X
		+ BI_DW.C_ZDEP_CJ
		+ BI_DW.TMP_KPI040_021GT_CNFLST
		+ BI_DW.TMP_KPI040_291GT_DETAIL
		+ BI_DW.TMP_KPI040_291HLF_IMPSUM
		+ BI_DW.TMP_KPI040_IT_DATA
		+ BI_DW.TMP_KPI040_ZTOT_HOURS
		+ BI_DW.TMP_PP_KPI040_DLVLSTADJ
		+ BI_DW.TMP_PP_KPI040_EMPLOYEE_TOTAL
	+ 关联参数 
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_F_AVG_MAN_HOUR_2
	+ 实现功能
		+ 计算各车间需要增加的工时，并累加到原有的工时上
		+ 改善未推广工时追加到相关车间的订单工时数据中
	+ 目标表
		+ BI_DM.TMP_PP_KPI040_OEM_HOUR
		+ BI_DM.TMP_PP_KPI040_8JOB
		+ BI_DM.TMP_PP_KPI040_WSVOR_HOUR
		+ BI_DM.TMP_PP_KPI040_UNEXT_HOUR
	+ 数据源表
		+ BI_DM.D_WORKSHOP
		+ BI_DM.ETL_LOAD_PLAN
		+ BI_DM.F_AVG_MAN_HOUR
		+ BI_DM.TMP_PP_KPI040_DLVLST
		+ BI_DM.TMP_PP_KPI040_WSVOR_HOUR
		+ BI_DW.C_T527X
		+ BI_DW.C_ZDEP_CJ
		+ BI_DW.EVT_VEHICLE_ORDER_REAL
		+ BI_DW.EVT_ZPPT0083
		+ BI_DW.EVT_ZPPT0085
		+ BI_DW.TMP_KPI040_8JOB_CONENT
		+ BI_DW.TMP_KPI040_ADD_MEND_HOUR
	+ 关联参数 
		+ `NULL`
+ S_F_AVG_MAN_HOUR_3
	+ 实现功能
		+ 取得标准化一车间与六车间之间的27%比例的订单工时划分
		+ 标准化二车间与制件二车间之间的8%比例的订单工时划分
	+ 目标表
		+ BI_DM.TMP_PP_KPI040_VOR_DIV
	+ 数据源表
		+ BI_DW.C_T527X
		+ BI_DW.EVT_ZPPT0088
	+ 关联参数 
+ S_F_AVG_MAN_HOUR_4
	+ 实现功能
		+ 高档车间工时计算
	+ 目标表
		+ BI_DM.TMP_PP_KPI040_DLVLSTADJ
	+ 数据源表
		+ BI_DW.EVT_ZPPT0086
		+ BI_DW.TMP_PP_KPI040_DLVLSTADJ
	+ 关联参数 
		+ `NULL`
+ S_F_AVG_MAN_HOUR_5
	+ 实现功能
		+ 从按时间关键字 车间 工序汇总的数据
		+ 进一步汇总到只按时间关键字 和 车间汇总的数据
		+ 其间要补充代工工时，包括体系外代工和体系内代工
	+ 目标表
		+ BI_DM.F_AVG_MAN_HOUR
		+ BI_DM.TMP_PP_KPI040_ORDHOUR
	+ 数据源表
		+ BI_DM.TMP_PP_KPI040_8JOB
		+ BI_DM.TMP_PP_KPI040_OEM_HOUR
		+ BI_DM.TMP_PP_KPI040_TOPGRADE
		+ BI_DM.TMP_PP_KPI040_VOR_DIV
		+ BI_DM.TMP_PP_KPI040_WSVOR_HOUR
		+ BI_DW.D_WORKSHOP
		+ BI_DW.EVT_ZPPT0082
		+ BI_DW.EVT_ZPPT0084
		+ BI_DW.EVT_ZPPT0086
		+ BI_DW.EVT_ZPPT0087
	+ 关联参数 
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_F_AVG_MAN_HOUR_KPI
	+ 实现功能
		+ 计算指标值
	+ 目标表
		+ BI_DM.F_AVG_MAN_HOUR_KPI
	+ 数据源表
		+ BI_DM.F_AVG_MAN_HOUR
		+ BI_DW.APD_COMMON_TARGET
	+ 关联参数 
		+ `NULL`
+ S_F_AVG_MAN_HOUR_SUM
	+ 实现功能
		+ 汇总公司级别的指标值
	+ 目标表
		+ BI_DM.F_AVG_MAN_HOUR
		+ BI_DM.TMP_PP_KPI040_ORDHOUR
	+ 数据源表
		+ BI_DM.F_AVG_MAN_HOUR
		+ BI_DM.TMP_PP_KPI040_ORDHOUR
	+ 关联参数 
		+ `NULL`

### ODS_DW层
[Top](#TableOfContent)

+ S_TMP_KPI040_021GT_CNFLST
	+ 实现功能
		+ 事务码 ZPPR0021 月完工报表
	+ 目标表
		+ BI_DM.TMP_KPI040_021GT_CNFLST
	+ 数据源表
		+ BI_DW.EVT_YTSN01
		+ BI_DW.EVT_STOCK_DOC
		+ BI_DW.EVT_VIEW_PRD_ORDER
	+ 关联表
		+ BI_ODS.YTMOD
		+ BI_DW.EVT_VIEW_SALES_ORDER
		+ BI_DW.EVT_ZAFVV
	+ 关联参数 
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_291_OPT
	+ 实现功能
		+ 事务码 ZPPR0291 - 工时改善计提 流水线 __选配__ 
	+ 目标表
		+ BI_DW.TMP_KPI040_291GT_DETAIL
	+ 源表
		+ BI_DW.TMP_KPI040_291LT_AFRU
		+ BI_ODS.ZPPT0077 
+ S_TMP_KPI040_291GT_AFRU
	+ 实现功能
		+ 事务码 ZPPR0291 - 流水线自主改善工时计提-提取 __合装__ __焊装__ __涂装__ __全承载底盘__ 的完工数据
	+ 目标表
		+ BI_DW.TMP_KPI040_291GT_AFRU
	+ 源表
		+ BI_DW.EVT_VIEW_PRD_ORDER
		+ BI_DW.EVT_VIEW_SALES_ORDER
		+ BI_DW.EVT_YTSN01
	+ 关联表
		+ BI_ODS.YTMOD
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_291GT_DETAIL
	+ 实现功能
		+ ZPPR0291-流水线自主改善工时计提-取得工时改善信息明细
		+ 取得完工日期在生效日期范围内的条目
		+ 限定特性和特性值都是空值的数据
	+ 目标表
		+ BI_DW.TMP_KPI040_291GT_DETAIL
	+ 源表
		+ BI_DW.TMP_KPI040_291GT_AFRU
		+ BI_DW.TMP_KPI040_291GT_PPT49
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_291GT_MKPF
	+ 实现功能
		+ ZPPR0291 流水线整车入库记录
	+ 目标表
		+ BI_DW.TMP_KPI040_291GT_MKPF
		+ BI_DW.TMP_KPI040_291GT_AFRU
	+ 源表
		+ BI_DW.EVT_STOCK_DOC
		+ BI_DW.EVT_VIEW_PRD_ORDER
		+ BI_DW.EVT_VIEW_SALES_ORDER
	+ 关联表
		+ BI_ODS.YTMOD
		+ BI_DW.EVT_VIEW_SALES_ORDER
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_291GT_PPT49
	+ 实现功能
		+ ZPPR0291-流水线自主改善工时计提-自主改善工时计提 - __标配 + 选配__
		+ 标配的特征是`ATINN` 和 `ATWRT` 都是空的
		+ 选配的特征是`ATINN` 或者 `ATWRT` 是空的 
	+ 目标表
		+ BI_DW.TMP_KPI040_291GT_PPT49
		+ BI_DW.TMP_KPI040_291LT_AFRU
	+ 源表
		+ BI_DW.EVT_ZPPT0049
		+ BI_DW.TMP_KPI040_291GT_AFRU
	+ 关联表
	+ 参数
		+ `$$KPI040_MANAGE_YEAR`
+ S_TMP_KPI040_291HLF_IMPROVE
	+ 实现功能
		+ ZPPR0291-半成品自主改善工时__计提__-改善数据清单
	+ 目标表
		+ BI_DW.TMP_KPI040_291HLF_IMPROVE
		+ BI_DW.TMP_KPI040_291HLF_CNFLST
	+ 源表
		+ BI_DW.EVT_AFPO
		+ BI_DW.EVT_AFRU
		+ BI_DW.EVT_AUFK
		+ BI_DW.PRD_MARC
		+ BI_ODS.YTMOD
		+ BI_ODS.ZPPT0105
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_291HLF_IMPSUM
	+ 实现功能
		+ ZPPR0291 半成品自主改善工时__汇总__
	+ 目标表
		+ BI_DW.TMP_KPI040_291HLF_IMPSUM
	+ 源表
		+ BI_DW.EVT_ZPPT0049
		+ BI_DW.TMP_KPI040_291HLF_IMPROVE
	+ 关联表
	+ 参数
		+ `$$KPI040_MANAGE_YEAR`
+ S_TMP_KPI040_8JOB_CONENT
	+ 实现功能
		+ 提取承装一车间 需要安排六车间替代完成的**8项作业内容**工时数量信息
		+ 限制条件：
		+ `END_DT = TO_DATE('99991231','YYYYMMDD') AND
    NUMBER_ID IN ('9942-Z017',
                  '9942-Z018',
                  '9942-Z020',
                  '9942-Z030',
                  '9942-Z031',
                  '9944-Z002',
                  '9944-Z010',
                  '9944-Z013')`
	+ 目标表
		+ BI_DW.TMP_KPI040_8JOB_CONENT
	+ 源表
		+ BI_DW.PRD_ZMAN_HOUR_DATA
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_ADD_MEND_HOUR
	+ 实现功能
		+ 事务码 ZPPE0278 计算改善未推广工时数据
	+ 目标表
		+ BI_DW.TMP_KPI040_ADD_MEND_HOUR
	+ 源表
		+ BI_DW.EVT_ZPPT0049
		+ BI_DW.TMP_DATE_FILTER
	+ 关联表
	+ 参数
		+ `$$KPI040_LAST3MONTH_DT`
		+ `$$KPI040_DT_TO` 评估周期结束日
		+ `$$KPI040_MANAGE_YEAR` 管理年度
+ S_TMP_KPI040_CALC_VORNR_0090
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提-从0090工序的各条记录中扣减0111的工时长度，删除临时创建的0111工序条目
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_DATA
	+ 源表
		+ BI_DW.TMP_KPI040_IT_AFRU0111
		+ BI_DW.TMP_KPI040_IT_DATA
		+ BI_DW.TMP_KPI040_IT_ONLINE
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_CALC_VORNR_0111
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提-更新0111工序的作业内容时间
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_DATA
		+ BI_DW.TMP_KPI040_IT_ONLINE
	+ 源表
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_DW.TMP_KPI040_IT_DATA
		+ BI_DW.TMP_KPI040_IT_MANHOUR
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_EMPLOYEELIST
	+ 实现功能
		+ 事务码ZHRR0004 
汇总读取ODS层处理完成的人员清单记录信息
只考虑人均产出工时涉及到的生产体系相关组织单位的人员清单
	+ 目标表
		+ BI_ODS.TMP_KPI040_EMPLOYEELIST
	+ 源表
		+ BI_ODS.HRP1001
		+ BI_ODS.PA0000
		+ BI_ODS.PA0001
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
+ S_TMP_KPI040_GT_HORDAT
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提-**承装类标配工时**+**选配工时**
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_MANHOUR
		+ BI_DW.TMP_KPI040_GT_HORDAT
	+ 源表
		+ BI_DW.PRD_ZMAN_HOUR_DATA
		+ BI_DW.TMP_KPI040_GT_PPT45
		+ BI_DW.TMP_KPI040_IT_AFRU
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_GT_PPT45
	+ 实现功能
		+ 事务码 ZPPR0219 读取 *销售订单特殊作业内容*
	+ 目标表
		+ BI_DW.TMP_KPI040_GT_PPT45
	+ 源表
		+ BI_DW.EVT_ZPPT0045
		+ BI_DW.TMP_KPI040_IT_AFRU
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_IT_AFRU
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提-*完工信息记录清单*
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_AFRU
	+ 源表
		+ BI_DW.EVT_VIEW_PRD_ORDER 
		+ BI_DW.EVT_YTSN01
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_DW.TMP_KPI040_IT_MSEG
		+ BI_ODS.YTMOD
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_IT_AFRU0111
	+ 实现功能
		+ ZPPR0219-车间总工时计提-完工信息记录清单 0111
		+ 筛选完工记录中工序为0090的数据，查看是否存在0111的相关记录，如果不存在，则补充0111的记录
		+ 按JIT排产生产线更新生产线信息记录
			+ 如果JIT排产工序读取失败，不需要更新
			+ 如果JIT排产的产线跟订单产线一致，不需要更新
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_DW.TMP_KPI040_IT_AFRU0111
	+ 源表
		+ BI_DW.TMP_KPI040_IT_AFRU
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_IT_DATA
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提
			+ Step 1: 计算销售订单特殊作业内容工时，存放至TMP_KPI040_SO_SPEC_HOUR
			+ Step 2: 计算其他工时，并加上step 1的工时，获取总工时
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_DATA
	+ 源表
		+ BI_DW.C_ZDEP_CJ
		+ BI_DW.PRD_ZMAN_HOUR_SUM
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_DW.TMP_KPI040_IT_PPT77
		+ BI_DW.TMP_KPI040_SO_SPEC_HOUR
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
+ S_TMP_KPI040_IT_MATNR
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提 - 取得关联物料编号清单
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_MATNR
	+ 源表
		+ BI_DW.TMP_KPI040_IT_AFRU
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_IT_MSEG
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提 - 读取承装工序的完工记录
		+ ZMAIN_MES表中1102工序的数据 记录到IT_AFRU表里面
  工序都记为0090
	   + 其他的 符合条件的物料凭证也直接记录到IT_MSEG表中
	   + 不过 工序要根据整车和底盘订单类型分别设置为0090和0050，整车订单类型和底盘订单类型以外的订单相关的数据，
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_DW.TMP_KPI040_IT_MSEG
	+ 源表
		+ BI_DW.EVT_STOCK_DOC
		+ BI_DW.EVT_VIEW_PRD_ORDER
		+ BI_DW.EVT_ZMAIN_MES
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_DW.TMP_KPI040_IT_MSEG
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_IT_MSEG0
	+ 实现功能
		+ ZPPR0219-车间总工时计提-从物料凭证提取整车和底盘交车记录
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_MSEG
	+ 源表
		+ BI_DW.EVT_STOCK_DOC
		+ BI_DW.EVT_VIEW_PRD_ORDER
		+ BI_ODS.YTMOD
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`
+ S_TMP_KPI040_IT_PPT77
	+ 实现功能
		+ 事务码 ZPPR0219-车间总工时计提- 整车物料-销售订单特性清单
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_PPT77
	+ 源表
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_ODS.ZPPT0077
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_IT_ZORD_CONF
	+ 实现功能
		+ ZPPR0219-车间总工时计提-销售订单特性配置项清单
	+ 目标表
		+ BI_DW.TMP_KPI040_IT_ZORD_CONF
	+ 源表
		+ BI_DW.EVT_ZORD_CONF
		+ BI_DW.TMP_KPI040_IT_AFRU
		+ BI_ODS.ZPPT0077
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_SO_SPEC_HOUR
	+ 实现功能
		+ ZPPR0219-车间总工时计提-销售订单特殊工时
	+ 目标表
		+ BI_DW.TMP_KPI040_SO_SPEC_HOUR
	+ 源表
		+ BI_DW.TMP_KPI040_GT_HORDAT
		+ BI_DW.TMP_KPI040_GT_PPT45
		+ BI_DW.TMP_KPI040_IT_AFRU
	+ 关联表
	+ 参数
		+ `NULL`
+ S_TMP_KPI040_ZTOT_HOURS
	+ 实现功能
		+ 查看特殊总工时 信息 数据来源是 ZTOT_HOURS[特殊总工时（ZPPE0123）]
	+ 目标表
		+ BI_DW.TMP_KPI040_ZTOT_HOURS
	+ 源表
		+ BI_DW.EVT_ZTOT_HOURS
		+ BI_ODS.HRP1000
	+ 关联表
	+ 参数
		+ `$$KPI040_DT_FROM`
		+ `$$KPI040_DT_TO`


##数据仓库数据检查
[Top](#TableOfContent)

###检查数据仓库中关联表记录的条目数
[Top](#TableOfContent)

``` sql
select count(1) from BI_DW.APD_COMMON_TARGET;
select count(1) from BI_DW.APD_PP_ACTOVER_LIST;
select count(1) from BI_DW.APD_PP_EMPLOYEE_TOTAL;
select count(1) from BI_DW.C_T527X;
select count(1) from BI_DW.C_ZDEP_CJ;
select count(1) from BI_DW.EVT_AFPO;
select count(1) from BI_DW.EVT_AFRU;
select count(1) from BI_DW.EVT_AUFK;
select count(1) from BI_DW.EVT_STOCK_DOC;
select count(1) from BI_DW.EVT_VEHICLE_ORDER_REAL;
select count(1) from BI_DW.EVT_VIEW_PRD_ORDER;
select count(1) from BI_DW.EVT_VIEW_SALES_ORDER;
select count(1) from BI_DW.EVT_YTSN01;
select count(1) from BI_DW.EVT_YTVIN;
select count(1) from BI_DW.EVT_ZAFVV;
select count(1) from BI_DW.EVT_ZMAIN_MES;
select count(1) from BI_DW.EVT_ZORD_CONF;
select count(1) from BI_DW.EVT_ZPPT0045;
select count(1) from BI_DW.EVT_ZPPT0049;
select count(1) from BI_DW.EVT_ZPPT0082;
select count(1) from BI_DW.EVT_ZPPT0083;
select count(1) from BI_DW.EVT_ZPPT0084;
select count(1) from BI_DW.EVT_ZPPT0085;
select count(1) from BI_DW.EVT_ZPPT0086;
select count(1) from BI_DW.EVT_ZPPT0087;
select count(1) from BI_DW.EVT_ZPPT0088;
select count(1) from BI_DW.EVT_ZTOT_HOURS;
select count(1) from BI_DW.PRD_MARC;
select count(1) from BI_DW.PRD_ZMAN_HOUR_DATA;
select count(1) from BI_DW.PRD_ZMAN_HOUR_SUM;
select count(1) from BI_DW.TMP_DATE_FILTER;
```
